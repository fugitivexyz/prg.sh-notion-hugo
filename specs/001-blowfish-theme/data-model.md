# Data Model: Switch to Blowfish Theme

**Feature Branch**: `001-blowfish-theme`
**Date**: 2026-01-04

## Overview

This document defines the data structures involved in the Blowfish theme migration, focusing on front matter field mappings and Hugo configuration schema.

---

## Entity: Front Matter (Markdown Files)

The front matter is YAML metadata at the top of each Markdown content file generated by the Notion sync pipeline.

### Field Definitions

| Field | Type | Required | DoIt Name | Blowfish Name | Description |
|-------|------|----------|-----------|---------------|-------------|
| `title` | string | Yes | `title` | `title` | Page title from Notion |
| `date` | datetime | Yes | `date` | `date` | Created time (ISO 8601) |
| `lastmod` | datetime | Yes | `lastmod` | `lastmod` | Last edited time |
| `draft` | boolean | Yes | `draft` | `draft` | Publication status |
| `featureimage` | string | No | `featuredImage` | `featureimage` | Cover image URL via API proxy |
| `description` | string | No | `description` | `description` | Page description/excerpt |
| `tags` | string[] | No | `tags` | `tags` | Tag taxonomy |
| `categories` | string[] | No | `categories` | `categories` | Category taxonomy |
| `authors` | string[] | No | `authors` | `authors` | Author names array |
| `showHero` | boolean | No | N/A | `showHero` | Display feature image as hero |
| `heroStyle` | string | No | N/A | `heroStyle` | Hero display mode: basic, big, background |
| `showTaxonomies` | boolean | No | N/A | `showTaxonomies` | Display tags/categories on page |
| `NOTION_METADATA` | object | Yes | `NOTION_METADATA` | `NOTION_METADATA` | Raw Notion page object |
| `MANAGED_BY_NOTION_HUGO` | boolean | Yes | `MANAGED_BY_NOTION_HUGO` | `MANAGED_BY_NOTION_HUGO` | Sync tracking flag |

### Validation Rules

1. `title` MUST NOT be empty
2. `date` MUST be valid ISO 8601 datetime
3. `featureimage` MUST be a valid URL or API proxy path (`/api?block_id=xxx`)
4. `tags` and `categories` MUST be arrays (can be empty)
5. `MANAGED_BY_NOTION_HUGO` MUST be `true` for synced content

### State Transitions

Front matter is generated fresh on each sync. States:
- **New**: Page doesn't exist locally, created from Notion
- **Updated**: `last_edited_time` differs, regenerated
- **Skipped**: `last_edited_time` matches, no action
- **Orphaned**: Local file exists but Notion source removed → deleted

---

## Entity: Hugo Configuration

Hugo configuration files in `config/_default/` directory.

### hugo.toml (Site Configuration)

| Field | Type | Value | Description |
|-------|------|-------|-------------|
| `baseURL` | string | Site URL | Root URL for absolute links |
| `languageCode` | string | `"en-us"` | Site language |
| `defaultContentLanguage` | string | `"en"` | Default language code |
| `title` | string | Site title | Displayed in browser/SEO |
| `enableRobotsTXT` | boolean | `true` | Generate robots.txt |
| `enableGitInfo` | boolean | `true` | Enable git metadata |
| `enableEmoji` | boolean | `true` | Parse emoji codes |

### module.toml (Theme Import)

```toml
[[imports]]
disable = false
path = "github.com/nunocoracao/blowfish/v2"
```

### params.toml (Theme Parameters)

| Field | Type | Value | Description |
|-------|------|-------|-------------|
| `colorScheme` | string | `"blowfish"` | Theme color scheme |
| `defaultAppearance` | string | `"light"` | Initial appearance mode |
| `autoSwitchAppearance` | boolean | `true` | Respect system preference |
| `enableSearch` | boolean | `true` | Enable Fuse.js search |
| `enableCodeCopy` | boolean | `true` | Code block copy button |
| `[homepage].layout` | string | `"page"` | Homepage layout type |
| `[homepage].showRecent` | boolean | `true` | Show recent posts |
| `[homepage].recentLimit` | int | `10` | Number of recent posts |
| `[article].showDate` | boolean | `true` | Display post date |
| `[article].showAuthor` | boolean | `true` | Display author name |
| `[article].showTaxonomies` | boolean | `true` | Display tags/categories |
| `[article].showTableOfContents` | boolean | `true` | Show TOC |

### menus.en.toml (Navigation)

```toml
[[main]]
name = "Posts"
pageRef = "/posts"
weight = 10

[[main]]
name = "Tags"
pageRef = "/tags"
weight = 20

[[main]]
name = "Categories"
pageRef = "/categories"
weight = 30

[[main]]
name = "About"
pageRef = "/about"
weight = 40
```

### languages.en.toml (Language Settings)

```toml
languageCode = "en"
languageName = "English"
weight = 1

[params]
displayName = "EN"
isoCode = "en"
```

---

## Entity: Notion Property Mapping

How Notion page properties map to front matter fields.

| Notion Property Type | Front Matter Field | Transformation |
|---------------------|-------------------|----------------|
| `title` | `title` | First plain text value |
| `created_time` | `date` | ISO 8601 format |
| `last_edited_time` | `lastmod` | ISO 8601 format |
| `checkbox` | `draft` (inverted) | Boolean |
| `select` | Property name | String value |
| `multi_select` | Property name | String array |
| `date` | Property name | ISO 8601 start date |
| `people` | `authors` | Array of user names |
| `rich_text` | Property name | Plain text concatenation |
| `cover (external)` | `featureimage` | API proxy URL |
| `cover (file)` | `featureimage` | API proxy URL |

---

## Relationships

```
┌─────────────────────┐
│   Notion Page       │
│   (source)          │
└──────────┬──────────┘
           │ sync pipeline
           ▼
┌─────────────────────┐
│   Markdown File     │
│   with Front Matter │
└──────────┬──────────┘
           │ hugo build
           ▼
┌─────────────────────┐
│   Hugo Site         │
│   (Blowfish theme)  │
└─────────────────────┘
```

---

## Migration Considerations

### Breaking Changes
- `featuredImage` → `featureimage` (case change)
- Existing content will need rebuild after sync

### Backward Compatibility
- `NOTION_METADATA` and `MANAGED_BY_NOTION_HUGO` unchanged
- Taxonomies (tags, categories) unchanged
- Authors field compatible with both themes

### Non-Breaking Additions
- `showHero`, `heroStyle` (optional Blowfish fields)
- `showTaxonomies` (optional display control)
